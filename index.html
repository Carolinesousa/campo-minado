<!DOCTYPE html>
<html>

<head>
    <title></title>
    <script src="js/campo-minado.js"></script>
</head>

<body>
    <div id="exibir-execucao"></div>

    <script>
        var campoMinado = new CampoMinado();


        const Bombas = []

        const FindBomba = (pos) => !!Bombas.find(
            (bomba) => bomba[0] === pos[0] && bomba[1] === pos[1]
        )

        function VerificaBomba(arr) {
            var coord = []

            for (i = 0; i < arr.length; i++) {
                var resultado = FindBomba(arr[i])
                if (result === false) {
                    coord.push(arr[i])
                }

            }

            return coord
        }

        function VerificaVizinhos(pos, valores, coordenadas) {

            var fechados = []
            for (i = 0; i < valores.length; i++) {
                if (valores[i] === '-')
                    fechados.push(coordenadas[i])
            }
            if (fechados.length === parseInt(pos)) {
                console.log('Fechados:', fechados)
                for (i = 0; i < fechados.length; i++) {
                    var result = FindBomba(fechados[i])
                    if (result === false) {
                        Bombas.push(fechados[i])
                    }

                }
            }
            return Bombas
        }



        function AbrirEntorno(pos, arr) {
            if (pos === '0') {
                for (i = 0; i < arr.length; i++) {
                    campoMinado.Abrir(arr[i])
                }
            }
            if (pos === '1') {
                var casasLivres = VerificaBomba(arr)
                console.log(casasLivres)
                var num = arr.length - casasLivres.length
                if (num === 1) {
                    for (i = 0; i < casasLivres.length; i++) {
                        if (tabuleiro[casasLivres[i][0]][casasLivres[i][1]] === '-') {
                            campoMinado.Abrir((casasLivres[i][0]) + 1, (casasLivres[i][1] + 1))
                            document.getElementById('exibir-execucao').innerHTML += '<pre>' + campoMinado.Tabuleiro() + '</pre>';

                        }
                    }
                }
            }
            if (pos === '2') {
                var casasLivres = VerificaBomba(arr)
                console.log(casasLivres)
                var num = arr.length - casasLivres.length
                if (num === 2) {
                    for (i = 0; i < casasLivres.length; i++) {
                        if (tabuleiro[casasLivres[i][0]][casasLivres[i][1]] === '-') {
                            campoMinado.Abrir((casasLivres[i][0]) + 1, (casasLivres[i][1] + 1))
                            document.getElementById('exibir-execucao').innerHTML += '<pre>' + campoMinado.Tabuleiro() + '</pre>';

                        }
                    }
                }
            }
            if (pos === '3') {
                var casasLivres = VerificaBomba(arr)
                console.log(casasLivres)
                var num = arr.length - casasLivres.length
                if (num === 3) {
                    for (i = 0; i < casasLivres.length; i++) {
                        if (tabuleiro[casasLivres[i][0]][casasLivres[i][1]] === '-') {
                            campoMinado.Abrir((casasLivres[i][0]) + 1, (casasLivres[i][1] + 1))
                            document.getElementById('exibir-execucao').innerHTML += '<pre>' + campoMinado.Tabuleiro() + '</pre>';

                        }
                    }
                }
            }
            if (pos === '4') {
                var casasLivres = VerificaBomba(arr)
                console.log(casasLivres)
                var num = arr.length - casasLivres.length
                if (num === 4) {
                    for (i = 0; i < casasLivres.length; i++) {
                        if (tabuleiro[casasLivres[i][0]][casasLivres[i][1]] === '-') {
                            campoMinado.Abrir((casasLivres[i][0]) + 1, (casasLivres[i][1] + 1))
                            document.getElementById('exibir-execucao').innerHTML += '<pre>' + campoMinado.Tabuleiro() + '</pre>';

                        }
                    }
                }
                console.log('ok')
            }
        }


        document.getElementById('exibir-execucao').innerHTML += '----------- Início do jogo -----------';
        document.getElementById('exibir-execucao').innerHTML += '<pre>' + campoMinado.Tabuleiro() + '</pre>';


        var tabuleiro = campoMinado.Tabuleiro().split('\r\n')
        var n = 0
        while (n < 2) {

            for (x = 0; x < 9; x++) {
                for (y = 0; y < 9; y++) {

                    if (x === 0 && y === 0) {
                        console.log('posi:', x, y)
                        coord = [[x, y + 1], tabuleiro[x + 1, y], tabuleiro[x + 1][y + 1]]
                        AbrirEntorno(tabuleiro[x][y], coord)
                    }

                    if (y === 8 && x === 0) {
                        console.log('posi:', x, y)
                        valores = [tabuleiro[x][y - 1], tabuleiro[x + 1][y], tabuleiro[x + 1][y - 1]]
                        coordenadas = [[x, y - 1], [x + 1, y], [x + 1, y - 1]]
                        VerificaVizinhos(tabuleiro[x][y], valores, coordenadas)
                        AbrirEntorno(tabuleiro[x][y], coordenadas)
                    }
                } if (x === 0 && y != 0 && y != 8) {

                    valores = [tabuleiro[x][y - 1], tabuleiro[x][y + 1], tabuleiro[x + 1][y], tabuleiro[x + 1][y - 1], tabuleiro[x + 1][y + 1]
                    ]
                    coordenadas = [[x][y - 1], [x][y + 1], [x + 1][y], [x + 1][y - 1], [x + 1][y + 1]]


                    VerificaVizinhos(tabuleiro[x][y], valores, coordenadas)
                    AbrirEntorno(tabuleiro[x][y], coordenadas)
                }
                if (x === 8 && y != 8) {
                    console.log(tabuleiro[x][y] + 'posição:  ' + x + y)
                    arr = [tabuleiro[x][y + 1], tabuleiro[x - 1][y], tabuleiro[x - 1][y + 1]]
                    coordenadas = [[x][y + 1], [x - 1][y], [x - 1][y + 1]]
                    VerificaVizinhos(tabuleiro[x][y], valores, coordenadas)
                    AbrirEntorno(tabuleiro[x][y], coordenadas)

                } if (x === 8 && y === 8) {
                    console.log(tabuleiro[x][y] + 'posição:  ' + x + y)
                    arr = [tabuleiro[x][y - 1], tabuleiro[x - 1][y], tabuleiro[x - 1][y - 1]]
                    coordenadas = [[x][y - 1], [x - 1][y], [x - 1][y - 1]]
                    VerificaVizinhos(tabuleiro[x][y], valores, coordenadas)
                    AbrirEntorno(tabuleiro[x][y], coordenadas)
                } if (x != 0 && x != 8 && y === 8) {
                    console.log(tabuleiro[x][y] + 'posição:  ' + x + y)
                    arr = [tabuleiro[x][y - 1], tabuleiro[x - 1][y], tabuleiro[x + 1][y], tabuleiro[x - 1][y - 1]]
                    coordenadas = [[x][y - 1], [x - 1][y], [x + 1][y], [x - 1][y - 1]]
                    VerificaVizinhos(tabuleiro[x][y], valores, coordenadas)
                    AbrirEntorno(tabuleiro[x][y], coordenadas)
                }
                if (x != 0 && y != 0 && x != 8 && y != 8) {
                    console.log('posic:', x, y)
                    coordenadas = [[x + 1, y - 1], [x - 1, y], [x, y - 1], [x, y + 1], [x - 1, y - 1], [x - 1, y + 1], [x + 1, y], [x + 1, y + 1]]


                    valores = [tabuleiro[x + 1][y - 1], tabuleiro[x - 1][y], tabuleiro[x][y - 1], tabuleiro[x][y + 1], tabuleiro[x - 1][y - 1], tabuleiro[x - 1][y + 1], tabuleiro[x + 1][y], tabuleiro[x + 1][y + 1]]


                    VerificaVizinhos(tabuleiro[x][y], valores, coordenadas)
                    AbrirEntorno(tabuleiro[x][y], coordenadas)
                }
                if (x != 0 && y === 0 && x != 8) {
                    console.log('posic:', x, y)
                    coordenadas = [[x - 1, y], [x + 1, y], [x, y + 1], [x - 1, y + 1], [x + 1, y + 1]]
                    valores = [tabuleiro[x - 1, y], tabuleiro[x + 1, y], tabuleiro[x, y + 1], tabuleiro[x - 1, y + 1], tabuleiro[x + 1, y + 1]]
                    VerificaBomba(tabuleiro[x][y], valores, coordenadas)
                    AbrirEntorno(tabuleiro[x][y], coordenadas)

                }
            }
        }
        console.log(Bombas)
        console.log(n)
        n++

    </script>
</body>

</html>